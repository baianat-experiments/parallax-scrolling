!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Flux=e()}(this,function(){"use strict";function t(t){return"string"==typeof t?document.querySelector(t):t}function e(t,e){var n=arguments;void 0===e&&(e=16);var i=!1;return function(){i||(t.apply(void 0,n),i=!0,setTimeout(function(){i=!1},e))}}function n(t,e){var n=e[0],i=e[1],a=n>i?n:i,r=n<i?n:i;return Math.max(Math.min(t,a),r)}function i(t,e,n){return"px"===e?t:t/100*n}function a(t,e){var n=t[0];return(t[1]-n)/e}var r=function(t,e){void 0===t&&(t=[]),void 0===e&&(e={});var n=e.breakpoint;void 0===n&&(n=0),this.elementsData=t,this.settings={breakpoint:n},this._init()};return r.prototype.addElement=function(t){var e=this;this.elementsData.push(t),this._initElements(),setTimeout(function(){return e.update()},500)},r.prototype._init=function(){var t=this;this.scrolled=window.scrollY,this.viewport={height:window.innerHeight,width:window.innerWidth},document.onreadystatechange=function(){"complete"===document.readyState&&(t._initObserver(),t._initElements(),t._initEvents(),t.update(!0))}},r.prototype._initElements=function(){var e=this;this.mediaQuery=window.matchMedia("(min-width: "+this.settings.breakpoint+"px)"),this.elements=[],this.elementsData.forEach(function(n){var i=t(n.element);n.element=i,n.omit||(n.rect=i.getBoundingClientRect(),e.addMissingTransformation(n),e.generateFixedData(n)),e.observer.observe(i),e.elements.push(n.element)})},r.prototype._initObserver=function(){this.observer=new IntersectionObserver(function(t){t.forEach(function(t){t.isIntersecting?t.target.dataset.fluxInViewport="true":t.target.dataset.fluxInViewport=""})})},r.prototype._initEvents=function(){var t=this;this.scrolling=!1,window.addEventListener("scroll",function(){t.scrolled=window.scrollY,t.scrolling||(window.requestAnimationFrame(function(){t.update(),t.scrolling=!1}),t.scrolling=!0)},{passive:!0}),window.addEventListener("resize",e(function(){t.viewport={height:window.innerHeight,width:window.innerWidth},t.scrolled=window.scrollY,t.elementsData.forEach(function(e){e.omit||(e.rect=e.element.getBoundingClientRect(),t.generateFixedData(e))}),t.update()},100))},r.prototype.update=function(t){var e=this;void 0===t&&(t=!1),this.elements.forEach(function(n,i){var a=e.elementsData[i];if(n.dataset.fluxInViewport||!a.class||"toggle"!==Object.values(a.class)[0]){if(n.dataset.fluxInViewport||t){if(a.class){var r="string"==typeof a.class?a.class:Object.keys(a.class)[0];n.classList.add(r)}if(!e.mediaQuery.matches)return a.element.style.transform="",void(a.element.style.opacity="");a.omit||(e.transform=e.getTransform(a),n.style.transform="\n          translateX("+e.transform.x+a.translate.unit+")\n          translateY("+e.transform.y+a.translate.unit+")\n          rotate("+e.transform.deg+"deg)\n          scale("+e.transform.scale+")",n.style.opacity=e.transform.opacity)}}else n.classList.remove(Object.keys(a.class)[0])})},r.prototype.getTransform=function(t){var e=this.scrolled-t.position,i=t.unitPerScroll;return{y:i.y?n(t.translate.y[0]+e*i.y,t.translate.y):0,x:i.x?n(t.translate.x[0]+e*i.x,t.translate.x):0,deg:i.deg?n(t.rotate[0]+e*i.deg,t.rotate):0,scale:i.scale?n(t.scale[0]+e*i.scale,t.scale):1,opacity:i.opacity?n(t.opacity[0]+e*i.opacity,t.opacity):1}},r.prototype.addMissingTransformation=function(t){t.translate||(t.translate={}),t.translate.x||(t.translate.x=[0,0]),t.translate.y||(t.translate.y=[0,0]),t.translate.unit||(t.translate.unit="px")},r.prototype.generateFixedData=function(t){var e=0,n=0;t.translate&&t.translate.y&&(e=i(t.translate.y[0],t.translate.unit,t.rect.height),n=i(t.translate.y[1]-t.translate.y[0],t.translate.unit,t.rect.height));var r=this.viewport.height+n+t.rect.height;t.position=this.scrolled+t.rect.top+e-this.viewport.height,t.unitPerScroll={y:t.translate.y?a(t.translate.y,r):void 0,x:t.translate.x?a(t.translate.x,r):void 0,deg:t.rotate?a(t.rotate,r):void 0,scale:t.scale?a(t.scale,r):void 0,opacity:t.opacity?a(t.opacity,r):void 0}},r});